<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<<<<<<< HEAD
    <title>Advanced GoRydz Chatbot</title>
=======
    <title>Simple Chatbot</title>
>>>>>>> cars-branch
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0c0c0cff 0%, #0d0d0eff 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #080808ff 0%, #060707ff 100%);
            padding: 30px;
            text-align: center;
            color: white;
<<<<<<< HEAD
            position: relative;
=======
>>>>>>> cars-branch
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
<<<<<<< HEAD
        #clear-chat {
            position: absolute;
            top: 10px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        #clear-chat:hover {
            background: rgba(255,255,255,0.4);
        }
        
=======
>>>>>>> cars-branch
        #chat-messages {
            height: 400px;
            padding: 30px;
            overflow-y: auto;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .message {
            margin: 15px 0;
            animation: fadeIn 0.5s ease-in;
<<<<<<< HEAD
            position: relative;
        }
        
        .message .timestamp {
            font-size: 0.8em;
            color: #999;
            margin-top: 5px;
            text-align: right;
=======
>>>>>>> cars-branch
        }
        
        .user-message {
            text-align: right;
        }
        
        .user-message .bubble {
            background: linear-gradient(135deg, #0b0b0cff 0%, #118ee2ff 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 25px 25px 5px 25px;
            display: inline-block;
            max-width: 70%;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .ai-message .bubble {
            background: white;
            color: #333;
            padding: 15px 20px;
            border-radius: 25px 25px 25px 5px;
            display: inline-block;
            max-width: 70%;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }
        
<<<<<<< HEAD
        .quick-replies {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .quick-reply-btn {
            background: #e9ecef;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        
        .quick-reply-btn:hover {
            background: #d1d5db;
        }
        
=======
>>>>>>> cars-branch
        .input-area {
            padding: 30px;
            background: white;
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        #user-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        #user-input:focus {
            border-color: #667eea;
        }
        
        .send-button {
            background: linear-gradient(135deg, #0aa2adff 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .send-button:hover {
            transform: translateY(-2px);
        }
        
        .send-button:active {
            transform: translateY(0);
        }
        
        .typing {
            color: #666;
            font-style: italic;
            animation: pulse 1s infinite;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
<<<<<<< HEAD
=======
        
        .robot-emoji {
            font-size: 1.2em;
            margin-right: 5px;
        }
>>>>>>> cars-branch
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
<<<<<<< HEAD
            <h1>Advanced GoRydz Chatbot</h1>
            <p>Powered by Smart AI - Built with Love</p>
            <button id="clear-chat">Clear Chat</button>
        </div>
        
        <div id="chat-messages">
            <!-- Messages will be loaded here -->
=======
            <h1>ðŸ¤– Smart Chatbot</h1>
            <p> Built with Love</p>
        </div>
        
        <div id="chat-messages">
            <div class="message ai-message">
                <div class="bubble">
                    <span class="robot-emoji">ðŸ¤–</span>
                    Hello! I'm your friendly chatbot. I'm ready to chat with you! Ask me anything or just say hi!
                </div>
            </div>
>>>>>>> cars-branch
        </div>
        
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Type your message here...">
<<<<<<< HEAD
            <button class="send-button" onclick="sendMessage()">Send</button>
=======
            <button class="send-button" onclick="sendMessage()">Send ðŸš€</button>
>>>>>>> cars-branch
        </div>
    </div>

    <script>
<<<<<<< HEAD
        // GoRydz company details
        const companyDetails = {
            whyChoose: "Experience the ultimate car rental service with our commitment to excellence and customer satisfaction. We offer a wide selection of premium vehicles, transparent pricing with no hidden fees, 24/7 customer support, an easy online booking system, flexible rental periods, and fully insured vehicles.",
            contact: "Contact us at +94 77 123 4567, email: info@gorydz.com, address: 123 Main Street, Negombo, Sri Lanka. Operating hours: Monday to Sunday, 8:00 AM to 10:00 PM.",
            services: "From economy cars to luxury vehicles, we have the perfect ride for every occasion. Our services include daily and weekly rentals, airport pickup/drop-off, long-term leasing, corporate fleet solutions, wedding and event cars, and GPS navigation systems."
        };

        // Car details array
        const cars = [
            {
                brand: "Mitsubishi",
                model: "Lancer Ex",
                year: 2008,
                location: "Kalutara, Colombo",
                seats: 4,
                pricePerDay: 4000.00,
                rating: "4.8 (127 reviews)",
                description: "Year: 2008, Transmission: Automatic, Fuel Type: Petrol, Engine: 1,500cc, Mileage: 212,000 km, Condition: Used, well-maintained, Body Type: Saloon",
                availability: "Available"
            },
            {
                brand: "BMW",
                model: "X1",
                year: 2020,
                location: "Main Office",
                seats: 4,
                pricePerDay: 7000.00,
                rating: "4.8 (127 reviews)",
                description: "Condition: Used, Transmission: Automatic, Body Type: SUV / 4x4, Fuel Type: Petrol, Engine Capacity: 1,500 cc, Mileage: 87,000 km",
                availability: "Available"
            },
            {
                brand: "Audi",
                model: "A3",
                year: 2015,
                location: "Main Office",
                seats: 4,
                pricePerDay: 5000.00,
                rating: "4.8 (127 reviews)",
                description: "Condition: Used, Transmission: Automatic, Body Type: Saloon, Fuel Type: Petrol, Engine Capacity: 1,800 cc, Mileage: 60,000 km",
                availability: "Available"
            },
            {
                brand: "Toyota",
                model: "Axio Corolla",
                year: 2024,
                location: "Main Office",
                seats: 4,
                pricePerDay: 5200.00,
                rating: "4.8 (127 reviews)",
                description: "Condition: New, Transmission: Automatic, Body Type: Saloon, Fuel Type: Petrol, Engine Capacity: 1,500 cc, Mileage: 102 km",
                availability: "Available"
            },
            {
                brand: "Honda",
                model: "Vezel Z",
                year: 2025,
                location: "Main Office",
                seats: 4,
                pricePerDay: 6000.00,
                rating: "4.8 (127 reviews)",
                description: "Condition: Used, Transmission: Tiptronic, Body Type: Saloon, Fuel Type: Hybrid, Engine Capacity: 1,500 cc, Mileage: 169 km",
                availability: "Available"
            },
            {
                brand: "Toyota",
                model: "Vitz",
                year: 2015,
                location: "Main Office",
                seats: 4,
                pricePerDay: 3000.00,
                rating: "4.8 (127 reviews)",
                description: "Condition: Used, Transmission: Automatic, Body Type: Hatchback, Fuel Type: Petrol, Engine Capacity: 1,000 cc, Mileage: 160,000 km",
                availability: "Available"
            },
            {
                brand: "Toyota",
                model: "Premio",
                year: 2014,
                location: "Kalutara, Colombo, Galle",
                seats: 5,
                pricePerDay: 4500.00,
                rating: "4.8 (127 reviews)",
                description: "Condition: Used, Transmission: Automatic, Body Type: Saloon, Fuel Type: Petrol, Engine Capacity: 1,500 cc, Mileage: 160,000 km",
                availability: "Available"
            },
            {
                brand: "Perodua",
                model: "Axia",
                year: 2021,
                location: "Kalutara, Colombo, Galle",
                seats: 4,
                pricePerDay: 2000.00,
                rating: "Not rated",
                description: "Condition: Used â€“ Good, Transmission: Automatic, Body Type: Hatchback, Fuel Type: Petrol, Engine Capacity: 1,000 cc, Mileage: 12,400 km",
                availability: "Available"
            },
            {
                brand: "Honda",
                model: "Vezel Hybrid",
                year: 2023,
                location: "Kalutara, Negombo, Kandy, Galle",
                seats: 5,
                pricePerDay: 6000.00,
                rating: "Not rated",
                description: "Condition: New, Transmission: Automatic (Hybrid), Body Type: SUV, Fuel Type: Petrol / Hybrid, Engine Capacity: 1,500 cc, Mileage: 85 km",
                availability: "Available"
            },
            {
                brand: "Mitsubishi",
                model: "Mirage",
                year: 2017,
                location: "Kalutara, Negombo, Kandy, Galle, Colombo",
                seats: 4,
                pricePerDay: 2000.00,
                rating: "Not rated",
                description: "Condition: Used â€“ Excellent, Transmission: Automatic, Body Type: Hatchback, Fuel Type: Petrol, Engine Capacity: 1,200 cc, Mileage: 14,500 km",
                availability: "Available"
            }
        ];

        // Conversation context (for multi-turn awareness)
        let conversationContext = {
            lastCar: null,  // Remember the last mentioned car
            lastTopic: null, // 'car' or 'company'
            lastLocation: null // Remember the last mentioned location
        };

        // Load chat history from localStorage
        function loadChatHistory() {
            const history = JSON.parse(localStorage.getItem('chatHistory')) || [];
            history.forEach(msg => {
                appendMessage(msg.type, msg.content, msg.timestamp, msg.quickReplies);
            });
            $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
        }

        // Save chat history to localStorage
        function saveChatHistory() {
            const messages = [];
            $('#chat-messages .message').each(function() {
                const type = $(this).hasClass('user-message') ? 'user' : 'ai';
                const content = $(this).find('.bubble').text();
                const timestamp = $(this).find('.timestamp').text();
                const quickReplies = [];
                $(this).find('.quick-reply-btn').each(function() {
                    quickReplies.push($(this).text());
                });
                messages.push({ type, content, timestamp, quickReplies });
            });
            localStorage.setItem('chatHistory', JSON.stringify(messages));
        }

        // Append message to chat
        function appendMessage(type, content, timestamp = new Date().toLocaleTimeString(), quickReplies = []) {
            const messageClass = type === 'user' ? 'user-message' : 'ai-message';
            let html = `
                <div class="message ${messageClass}">
                    <div class="bubble">${content}</div>
                    <div class="timestamp">${timestamp}</div>
            `;
            if (quickReplies.length > 0) {
                html += '<div class="quick-replies">';
                quickReplies.forEach(reply => {
                    html += `<button class="quick-reply-btn" onclick="handleQuickReply('${reply}')">${reply}</button>`;
                });
                html += '</div>';
            }
            html += '</div>';
            $('#chat-messages').append(html);
            $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
            saveChatHistory();
        }

        // Handle quick reply clicks
        function handleQuickReply(reply) {
            // Check if the reply matches a car name
            const car = cars.find(c => `${c.brand} ${c.model}`.toLowerCase() === reply.toLowerCase());
            if (car) {
                // Directly generate a response for the car's details
                conversationContext.lastCar = car;
                conversationContext.lastTopic = 'car';
                $('#user-input').val(reply);
                const response = `Details for the ${car.brand} ${car.model}: ${car.description} Would you like to know more about its price, location, or other details?`;
                appendMessage('user', reply);
                const quickReplies = ['Price', 'Details', 'Year', 'Location', 'Seats', 'Rating'];
                setTimeout(() => {
                    $('.typing-message').remove();
                    appendMessage('ai', response, new Date().toLocaleTimeString(), quickReplies);
                }, 1000);
                $('#chat-messages').append(`
                    <div class="message ai-message typing-message">
                        <div class="bubble typing">
                            Thinking...
                        </div>
                    </div>
                `);
            } else {
                // For non-car quick replies (e.g., Contact Info)
                $('#user-input').val(reply);
                sendMessage();
            }
        }

        // Function to identify the car or location from the message
        function identifyCarOrLocation(message) {
            message = message.toLowerCase();
            const carPatterns = {
                "mitsubishi lancer": /mitsubishi|lancer/,
                "bmw x1": /bmw|x1/,
                "audi a3": /audi|a3/,
                "toyota axio corolla": /toyota.*(axio|corolla)/,
                "honda vezel z": /honda.*(vezel.*z)/,
                "toyota vitz": /toyota.*vitz/,
                "toyota premio": /toyota.*premio/,
                "perodua axia": /perodua|axia/,
                "honda vezel hybrid": /honda.*(vezel.*hybrid)/,
                "mitsubishi mirage": /mitsubishi.*mirage/
            };
            const locationPatterns = {
                "kalutara": /kalutara/,
                "colombo": /colombo/,
                "galle": /galle/,
                "negombo": /negombo/,
                "kandy": /kandy/,
                "main office": /main office/
            };

            // Check for car match
            for (const [key, pattern] of Object.entries(carPatterns)) {
                if (pattern.test(message)) {
                    const [brand, model] = key.split(' ');
                    const car = cars.find(car => car.brand.toLowerCase() === brand && car.model.toLowerCase() === model.replace('ex', 'Ex').replace('z', 'Z').replace('hybrid', 'Hybrid'));
                    if (car) return { type: 'car', value: car };
                }
            }

            // Check for location match
            for (const [location, pattern] of Object.entries(locationPatterns)) {
                if (pattern.test(message)) {
                    const matchedCars = cars.filter(car => car.location.toLowerCase().includes(location));
                    return { type: 'location', value: location, cars: matchedCars };
                }
            }

            return null;
        }

        // Function to check if the message is about a car, company, or location
        function isRelatedQuery(message) {
            const keywords = [
                "mitsubishi", "lancer", "bmw", "x1", "audi", "a3", "toyota", "axio", "corolla", "honda", "vezel",
                "vitz", "premio", "perodua", "axia", "mirage", "car", "price", "details", "seats", "year", "location",
                "rating", "description", "gorydz", "why choose", "contact", "services", "rental", "booking", "support",
                "fleet", "airport", "wedding", "leasing", "gps", "book", "reserve", "availability", "kalutara", "colombo",
                "galle", "negombo", "kandy", "main office"
            ];
            return keywords.some(keyword => message.toLowerCase().includes(keyword));
        }

        // Function to generate response with context awareness
        function generateResponse(message) {
            message = message.toLowerCase();
            let quickReplies = [];

            // Handle company-related queries
            if (message.includes("why choose") || message.includes("gorydz")) {
                conversationContext.lastTopic = 'company';
                quickReplies = ['Contact Info', 'Our Services'];
                return `GoRydz offers: ${companyDetails.whyChoose}`;
            } else if (message.includes("contact")) {
                conversationContext.lastTopic = 'company';
                quickReplies = ['Why Choose Us', 'Our Services'];
                return `Contact GoRydz at: ${companyDetails.contact}`;
            } else if (message.includes("services") || message.includes("rental") || message.includes("booking") ||
                       message.includes("fleet") || message.includes("airport") || message.includes("wedding") ||
                       message.includes("leasing") || message.includes("gps")) {
                conversationContext.lastTopic = 'company';
                quickReplies = ['Why Choose Us', 'Contact Info'];
                return `GoRydz provides: ${companyDetails.services}`;
            }

            // Handle car or location-related queries
            let result = identifyCarOrLocation(message);
            if (result) {
                if (result.type === 'car') {
                    const car = result.value;
                    conversationContext.lastCar = car;
                    conversationContext.lastTopic = 'car';
                    quickReplies = ['Price', 'Details', 'Year', 'Location', 'Seats', 'Rating'];
                    if (message.includes("price") || message.includes("cost") || message.includes("rate")) {
                        return `The price for the ${car.brand} ${car.model} is $${car.pricePerDay} per day.`;
                    } else if (message.includes("details") || message.includes("description") || message.includes("specs")) {
                        return `Details for the ${car.brand} ${car.model}: ${car.description}`;
                    } else if (message.includes("year") || message.includes("model year")) {
                        return `The ${car.brand} ${car.model} is from ${car.year}.`;
                    } else if (message.includes("location") || message.includes("where")) {
                        return `The ${car.brand} ${car.model} is located in ${car.location}.`;
                    } else if (message.includes("seats") || message.includes("capacity")) {
                        return `The ${car.brand} ${car.model} has ${car.seats} seats.`;
                    } else if (message.includes("rating") || message.includes("reviews")) {
                        return `The ${car.brand} ${car.model} has a rating of ${car.rating}.`;
                    } else if (message.includes("book") || message.includes("reserve") || message.includes("availability")) {
                        quickReplies.push('Contact Info');
                        return `The ${car.brand} ${car.model} is ${car.availability.toLowerCase()} for booking. Please contact us for reservations!`;
                    } else {
                        return `Details for the ${car.brand} ${car.model}: ${car.description} Would you like to know more about its price, location, or other details?`;
                    }
                } else if (result.type === 'location') {
                    const location = result.value.charAt(0).toUpperCase() + result.value.slice(1);
                    const matchedCars = result.cars;
                    conversationContext.lastLocation = location;
                    conversationContext.lastTopic = 'location';
                    quickReplies = matchedCars.map(car => `${car.brand} ${car.model}`);
                    if (matchedCars.length > 0) {
                        return `Available cars in ${location}: ${matchedCars.map(car => `${car.brand} ${car.model}`).join(', ')}. Which one would you like to know about?`;
                    } else {
                        return `No cars are available in ${location}. Try another location like Colombo, Kalutara, or Negombo, or contact us for assistance: ${companyDetails.contact}`;
                    }
                }
            }

            // Default response for unrelated queries
            quickReplies = ['Contact Info', 'Our Services'];
            return "Please specify a car or location to learn more about our vehicles.";
        }

=======
>>>>>>> cars-branch
        function sendMessage() {
            var userInput = $('#user-input').val().trim();
            if (userInput === '') return;
            
            // Add user message
<<<<<<< HEAD
            appendMessage('user', userInput);
=======
            $('#chat-messages').append(`
                <div class="message user-message">
                    <div class="bubble">
                        ${userInput}
                    </div>
                </div>
            `);
>>>>>>> cars-branch
            
            // Clear input
            $('#user-input').val('');
            
            // Show typing indicator
            $('#chat-messages').append(`
                <div class="message ai-message typing-message">
                    <div class="bubble typing">
<<<<<<< HEAD
=======
                        <span class="robot-emoji">ðŸ¤–</span>
>>>>>>> cars-branch
                        Thinking...
                    </div>
                </div>
            `);
            
<<<<<<< HEAD
            // Simulate delay for more realistic AI feel
            setTimeout(() => {
                // Remove typing indicator
                $('.typing-message').remove();
                
                // Generate and add AI response
                const response = generateResponse(userInput);
                const quickReplies = conversationContext.lastTopic === 'car' ? ['Price', 'Details', 'Year', 'Location', 'Seats', 'Rating'] : 
                                     conversationContext.lastTopic === 'company' ? ['Why Choose Us', 'Contact Info', 'Our Services'] :
                                     conversationContext.lastTopic === 'location' ? cars.filter(car => car.location.toLowerCase().includes(conversationContext.lastLocation.toLowerCase())).map(car => `${car.brand} ${car.model}`) : 
                                     ['Contact Info', 'Our Services'];
                appendMessage('ai', response, new Date().toLocaleTimeString(), quickReplies);
            }, 1000);  // 1-second delay for "thinking"
        }

        // Clear chat button
        $('#clear-chat').click(function() {
            $('#chat-messages').empty();
            localStorage.removeItem('chatHistory');
            conversationContext = { lastCar: null, lastTopic: null, lastLocation: null };
            appendMessage('ai', "Chat cleared. Hello! I'm your advanced chatbot for GoRydz. Ask me about our cars, services, or a location like Colombo!");
        });

=======
            // Scroll to bottom
            $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
            
            // Send to server
            $.ajax({
                url: '{% url "chat" %}',
                type: 'POST',
                data: { 'message': userInput },
                success: function(response) {
                    // Remove typing indicator
                    $('.typing-message').remove();
                    
                    // Add AI response
                    $('#chat-messages').append(`
                        <div class="message ai-message">
                            <div class="bubble">
                                <span class="robot-emoji">ðŸ¤–</span>
                                ${response.message}
                            </div>
                        </div>
                    `);
                    
                    // Scroll to bottom
                    $('#chat-messages').scrollTop($('#chat-messages')[0].scrollHeight);
                },
                error: function() {
                    $('.typing-message').remove();
                    $('#chat-messages').append(`
                        <div class="message ai-message">
                            <div class="bubble">
                                <span class="robot-emoji">ðŸ¤–</span>
                                Sorry, something went wrong. Please try again!
                            </div>
                        </div>
                    `);
                }
            });
        }
        
>>>>>>> cars-branch
        // Send message on Enter key
        $('#user-input').keypress(function(e) {
            if (e.which == 13) {
                sendMessage();
            }
        });
        
        // Auto-focus input
        $('#user-input').focus();
<<<<<<< HEAD

        // Load initial history and greeting if no history
        $(document).ready(function() {
            loadChatHistory();
            if ($('#chat-messages').children().length === 0) {
                appendMessage('ai', "Hello! I'm your advanced chatbot for GoRydz. Ask me about our cars, services, or a location like Colombo!");
            }
        });
=======
>>>>>>> cars-branch
    </script>
</body>
</html>